# PHPlot Reference Manual sources

This directory contains the DocBook-XML source files for the PHPlot Reference Manual. That is, it contains the files 
you need to build the manual. The manual is written in DocBook XML, and the HTML and PDF versions are built using the 
DocBook XSL style sheets.

This README is intended for authors, editors, and maintainers of the manual,
or anyone who wants to know how the manual is created and built.


## List of files:

  etc/                Extra files, php scripts used for non-example images
  examples/           Directory of "self-producing" examples
  images/             Image files, other than examples
  main.xml            Main source file for the manual
  *.xml               Source files for the manual's chapters
  ChangeLog           Record of old changes to the manual (recent changes are only in the git log on Github)
  gen.vardoc.php      Script to turn variables.list into DocBook XML
  pdf.xsl             XSL style sheet for producing PDF output
  phplotdoc.css       HTML style sheet for the manual
  README.md           This file
  style.xsl           XSL style sheet for producing XHTML output
  taskfile            Shell script for building the manual
  variables.list      Internal class variables documentation source file


## Building the documentation

The recommended way to set up those tools and build the manual is by executing the provided taskfile within a Container,
running a recent version of either Debian or Ubuntu (other OS might work, but have not been tested).

Example command which does everything in one shot:

    docker run --rm -it -v .:/var/www/phplot --workdir /var/www/phplot ubuntu:noble /var/www/phplot/doc/taskfile build_from_scratch

Note: the above command takes a lot of time, as it installs within the Container all the required tools before
starting the generation of the documentation. If you are planning to generate the documentation more than once,
you are better off persisting the Container for further usages.

Note: it is also possible to use the taskfile to build the documentation without using containers. In that case,
the required tools, listed below, will (have to) be installed on your computer. 


## Taskfile:

The taskfile is a shell script replacing the Makefile of old. It can be used to carry out a series of tasks.

__(this section is yet to be updated...)__


## Required tools (manual installation):

The following tools are used to produce the XHTML and PDF versions of the manual, and the API docs.

   DocBook XSL Style Sheets docbook-xsl-1.79.2
   Apache FOP
   xsltproc
   PHPDocumentor - used to generate the API docs from source code
   PHP (CLI) with the following extensions: ... 

The taskfile `setup_tools` task can be used to automatically install all of them, provided you are on a Debian or Ubuntu
OS.

Instead of using the taskfile `setup_tools` task to set them up for you, you can also install them manually within your
environment. Then, set the appropriate value to environment variables PHP, PHPDOCUMENTOR, XSLTPROC, FOP before
running the taskfile. 


## Example Figure Production:

The method for producing the examples requires some explanation. The goal
is to be sure the example figures in the manual are precisely generated by
the example code shown with the figure. To this end, only the PHP scripts
which generate the example figures are provided. The PHP CLI is used to
create the images. Note that the PHP CLI never outputs HTTP headers, so
SetIsInline(True) is not needed.

The taskfile automatically makes two files from each PHP script (*.php). An
image file (*.png or *.jpg) is created using PHPlot, and a text file
(*.xml) is created by wrapping the PHP script in CDATA markers inside a
programlisting element. The image file and the text file are included into
the manual to form the example figure and the source code which generates
it.

The taskfile contains a list of the examples scripts, and a list of the
image files they need to produce when run. (The Makefile used to do this
with a wildcard on examples/*.php and assumed each script made a PNG file,
but that no longer works as JPEGs are also possible.)


## Style Notes:

Writing XML or SGML for DocBook can be a challenge and a chore. I've adopted a
compromise position on indenting text and markup. Generally, I indent markup
blocks by 2 spaces at each level to help show the structure of the document.
But to keep this from getting out of hand, I usually move the top 2 or 3
elements flush to the left margin. This prevents the indent from moving too
far to the right, and also I feel that extremely long indent blocks don't
really help anyone see the structure. For example, I might write <chapter>,
<sect1>, and the top-level <para>s of the section all flush against the left
margin. The other oddity of my XML/SGML, and the one most noticeable, is that
while I indent tags, I usually don't indent text. In my opinion, it is just
not worth the difficulty typing and editing blocks of indented text.
So you will see writing like this:
```
<itemizedlist>
  <listitem>
    <para>
A color name, ...
    </para>
  </listitem>
```
I'm not saying this is the best way to write XML or SGML, just trying to
explain a little about how I do it and that it isn't completely random.


## XML vs SGML:

The first versions of this manual were written in DocBook SGML and
converted with DSSSL stylesheet processing tools. The current version
is in XML and is processed with XSLT tools.


## HTML vs XHTML:

The selection of an XSL style sheet determines the output format: HTML or
XHTML. Because the XHTML output is more standards-compliant, XHTML was
chosen. The output should display properly in all modern browsers.


## Member Variables documentation:

There is a table in the Member Variables chapter with information about
all the PHPlot class variables. The information about the variables is
maintained in the tab-separated text file 'variables.list'. This is converted
by the taskfile into a DocBook-XML file 'variables_list.xml', which is included
into the manual. The conversion is done using a short PHP script `gen.vardoc.php`.


## PDF Output:

Efforts toward producing a PDF version of the manual were restarted in
August 2010. Although the result is usable, the HTML version of the manual
is still considered to be of a higher quality than the PDF version. Some of
this is due to constraints imposed by the need of PDF to break a document
into equal sized pages. Some of the problem areas in PDF are:
* Images are scaled in order to fit on the pages. You can zoom
  in with your PDF reader to get a better view.
* Table column width settings are incompatible between HTML and PDF
  processing.
A great deal of effort went in to modifying the XML manual sources in order
to produce PDF, while trying to have little or no impact on the HTML manual.

The XSL stylesheet pdf.xsl contains workarounds and parameter adjustments
for PDF output. It includes the following:

* xref links are changed to underline and blue. (By default, there is no
way to visually identify links within the document, and the PHPlot manual
has a lot of internal links.)
* Tables are framed with borders
* Variablelists (definition lists) are displayed as blocks. The default is
to make a 2 column table which does not work at all with long definitions.
* A new element <pagebreak/> is defined to force a page break. It would be
better to never have to use this, but it seems hard to avoid. It is currently
only used in the Examples chapter, to make each example start on a new page
while still allowing them to span pages.
